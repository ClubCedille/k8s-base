apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: netdata

helmCharts:
  - name: netdata
    repo: https://netdata.github.io/helmchart
    version: 3.7.139
    releaseName: netdata
    valuesInline:
      k8sState:
        persistence:
          enabled: true
          storageClass: "cephfs"
      restarter:
        enabled: true
      parent:
        claiming:
          enabled: true
        envFrom:
        - secretRef:
            name: netdata-claim
        database:
          storageClass: "cephfs"
        alarms:
          storageClass: "cephfs"
        extraVolumeMounts:
          - name: netdata-lib
            mountPath: /var/lib/netdata
          - name: netdata-cache
            mountPath: /var/cache/netdata
        extraVolumes:
          - name: netdata-lib
            emptyDir:
              sizeLimit: 2Gi
          - name: netdata-cache
            emptyDir:
              sizeLimit: 1Gi
        securityContext:
          runAsUser: 201
          runAsGroup: 201
          fsGroup: 201
        podAnnotations:
          argocd.argoproj.io/sync-options: "ApplyOutOfOrder=true"
        database:
          storageClass: cephfs
        alarms:
          storageClass: cephfs
      child:
        claiming:
          enabled: true
        envFrom:
        - secretRef:
            name: netdata-claim
      ingress:
        enabled: false
      k8sState:
        persistence:
          storageClass: cephfs
